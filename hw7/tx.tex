\begin{tikzpicture}[scale=0.58,every node/.style={scale=0.58}]
\def\pkv#1#2{$(\mathit{PK}_{#1},#2)$}
\def\pkiv#1#2#3{$(\mathit{PK}_{#1#2}^\prime,#3)$}
\def\tx#1{$\mathit{tx}_{#1}$}
\tikzstyle{coin}=[draw,circle];
\tikzstyle{tx0}=[draw,text centered,minimum height=2cm];
\tikzstyle{tx1}=[draw,text centered,minimum height=5cm];
\tikzstyle{con}=[-{Stealth[length=3mm]},red];
\tikzstyle{gen}=[-{Stealth[length=3mm]},green!50!black];

\node [coin] (v1) at (0,0) {\pkv{A}{115}};
\node [tx0] (v2) at (2.5,0) {\tx{1}};
\draw [con] (v1) -- (v1 -| v2.west);

\node [coin] (v3) at (5,0) {\pkv{S}{115}};
\draw [gen] (v2.east |- v3) -- (v3);
\node [tx1] (v4) at (7.5,-1.5) {\tx{4}};

\draw [con]  (v3) -- (v3 -| v4.west);
\node [coin] (v5) at (10,0) {\pkiv{B}{1}{100}};
\draw [gen] (v4.east |- v5) -- (v5);
\node [coin] (v6) at (10,-2.5) {\pkv{S}{15}};
\draw [gen] (v4.east |- v6) -- (v6);


\node [tx1] (v24) at (12.5,-4) {\tx{10}};
\node [coin] (v25) at (15,-2.5) {\pkiv{B}{1}{10}};
\node [coin] (v26) at (15,-5) {\pkv{S}{5}};
\draw [con] (v6) -- (v6 -| v24.west);
\draw [gen] (v24.east |- v25) -- (v25);
\draw [gen] (v24.east |- v26) -- (v26);
\node [tx0] (v27) at (17.5,-5) {\tx{13}};
\node [coin] (v28) at (20,-5) {\pkiv{D}{1}{5}};
\draw [con] (v26) edge (v27);
\draw [gen] (v27) edge (v28);

%%

\node [coin] (v7) at (0,-5.5) {\pkv{B}{120}};
\node [tx0] (v8) at (2.5,-5.5) {\tx{2}};
\draw [con] (v7) -- (v7 -| v8.west);

\node [coin] (v9) at (5,-5.5) {\pkv{S}{120}};
\draw [gen] (v8.east |- v9) -- (v9);
\node [tx1] (v10) at (7.5,-7) {\tx{5}};

\draw [con]  (v9) -- (v9 -| v10.west);
\node [coin] (v11) at (10,-5.5) {\pkiv{A}{1}{100}};
\draw [gen] (v10.east |- v11) -- (v11);
\node [coin] (v12) at (10,-8) {\pkv{S}{20}};
\draw [gen] (v10.east |- v12) -- (v12);

\node [tx1] (v24) at (12.5,-9.5) {\tx{11}};
\node [coin] (v25) at (15,-8) {\pkiv{A}{2}{10}};
\node [coin] (v26) at (15,-10.5) {\pkv{S}{10}};
\draw [con] (v12) -- (v12 -| v24.west);
\draw [gen] (v24.east |- v25) -- (v25);
\draw [gen] (v24.east |- v26) -- (v26);
\node [tx0] (v27) at (17.5,-10.5) {\tx{14}};
\node [coin] (v28) at (20,-10.5) {\pkiv{C}{1}{10}};
\draw [con] (v26) edge (v27);
\draw [gen] (v27) edge (v28);

%%

\node [coin] (v13) at (0,-11) {\pkv{C}{12}};
\node [tx0] (v14) at (2.5,-11) {\tx{3}};
\draw [con] (v13) -- (v13 -| v14.west);

\node [coin] (v15) at (5,-11) {\pkv{S}{12}};
\draw [gen] (v14.east |- v15) -- (v15);
\node [tx1] (v16) at (7.5,-12.5) {\tx{6}};

\draw [con]  (v15) -- (v15 -| v16.west);
\node [coin] (v17) at (10,-11) {\pkiv{B}{3}{10}};
\draw [gen] (v16.east |- v17) -- (v17);
\node [coin] (v18) at (10,-13.5) {\pkv{S}{2}};
\draw [gen] (v16.east |- v18) -- (v18);


\node [tx1] (v24) at (12.5,-15) {\tx{12}};
\node [coin] (v25) at (15,-13.5) {\pkiv{E}{1}{1}};
\node [coin] (v26) at (15,-16) {\pkv{S}{1}};
\draw [con] (v18) -- (v18 -| v24.west);
\draw [gen] (v24.east |- v25) -- (v25);
\draw [gen] (v24.east |- v26) -- (v26);
\node [tx0] (v27) at (17.5,-16) {\tx{15}};
\node [coin] (v28) at (20,-16) {\pkiv{F}{1}{1}};
\draw [con] (v26) edge (v27);
\draw [gen] (v27) edge (v28);


%%

\node [coin] (v19) at (0,-16.5) {\pkv{D}{5}};
\node [tx0] (v20) at (2.5,-16.5) {\tx{7}};
\draw [con] (v19) -- (v20);
\node [coin] (v21) at (5,-16.5) {\pkv{S}{5}};
\draw [gen] (v20) edge (v21);
\node [tx0] (v22) at (7.5,-16.5) {\tx{16}};
\draw [con] (v21) -- (v22);
\node [coin] (v23) at (10,-16.5) {\pkiv{A}{3}{5}};
\draw [gen] (v22) edge (v23);


\node [coin] (v19) at (0,-19) {\pkv{E}{1}};
\node [tx0] (v20) at (2.5,-19) {\tx{8}};
\draw [con] (v19) -- (v20);
\node [coin] (v21) at (5,-19) {\pkv{S}{1}};
\draw [gen] (v20) edge (v21);
\node [tx0] (v22) at (7.5,-19) {\tx{17}};
\draw [con] (v21) -- (v22);
\node [coin] (v23) at (10,-19) {\pkiv{C}{2}{1}};
\draw [gen] (v22) edge (v23);


\node [coin] (v19) at (0,-21.5) {\pkv{F}{1}};
\node [tx0] (v20) at (2.5,-21.5) {\tx{9}};
\draw [con] (v19) -- (v20);
\node [coin] (v21) at (5,-21.5) {\pkv{S}{1}};
\draw [gen] (v20) edge (v21);
\node [tx0] (v22) at (7.5,-21.5) {\tx{18}};
\draw [con] (v21) -- (v22);
\node [coin] (v23) at (10,-21.5) {\pkiv{C}{3}{1}};
\draw [gen] (v22) edge (v23);

%%

\node [coin] (v29) at (14.5,-21) {coin};
\node [tx0] (v30) at (17.5,-21) {transcation};
\node [coin] (v31) at (20.5,-21) {coin};
\draw [con] (v29) edge node[above,red] {consume} (v30);
\draw [gen] (v30) edge node[above,green!50!black] {generate} (v31);
\draw  (13.5,-19.5) rectangle (21.5,-22.5);
\end{tikzpicture}